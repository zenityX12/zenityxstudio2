# คู่มือการใช้งาน ZenityX AI Studio

## ข้อมูลโปรเจค

- **ชื่อโปรเจค**: zenityx-ai-studio-deploy
- **เทคโนโลยี**: React 19 + Tailwind 4 + Express 4 + tRPC 11
- **ฐานข้อมูล**: MySQL/TiDB (ผ่าน Drizzle ORM)
- **การยืนยันตัวตน**: Manus OAuth
- **ฟีเจอร์**: Server + Database + User Authentication

---

## การติดตั้งและเริ่มต้นใช้งาน

### 1. ติดตั้ง Dependencies

```bash
cd zenityx-ai-studio-deploy
pnpm install
```

### 2. ตั้งค่า Environment Variables

สร้างไฟล์ `.env` ในโฟลเดอร์ root ของโปรเจค:

```env
# Database
DATABASE_URL=mysql://user:password@host:port/database

# JWT & Auth
JWT_SECRET=your-jwt-secret-key
OAUTH_SERVER_URL=https://api.manus.im
VITE_OAUTH_PORTAL_URL=https://login.manus.im
VITE_APP_ID=your-app-id

# Owner Info
OWNER_OPEN_ID=your-owner-open-id
OWNER_NAME=Your Name

# App Config
VITE_APP_TITLE=ZenityX AI Studio
VITE_APP_LOGO=/logo.svg

# Manus Built-in APIs
BUILT_IN_FORGE_API_URL=https://forge.manus.im
BUILT_IN_FORGE_API_KEY=your-forge-api-key

# Analytics (Optional)
VITE_ANALYTICS_ENDPOINT=
VITE_ANALYTICS_WEBSITE_ID=

# Omise Payment (Optional)
OMISE_PUBLIC_KEY=
OMISE_SECRET_KEY=
```

### 3. ตั้งค่าฐานข้อมูล

```bash
# Push schema ไปยังฐานข้อมูล
pnpm db:push
```

### 4. เริ่มต้น Development Server

```bash
pnpm dev
```

เว็บไซต์จะเปิดที่ `http://localhost:3000`

---

## โครงสร้างโปรเจค

```
zenityx-ai-studio-deploy/
├── client/                 # Frontend (React)
│   ├── public/            # Static assets
│   ├── src/
│   │   ├── pages/         # หน้าเว็บต่างๆ
│   │   ├── components/    # UI Components
│   │   ├── contexts/      # React Contexts
│   │   ├── hooks/         # Custom Hooks
│   │   ├── lib/           # tRPC Client
│   │   ├── App.tsx        # Routes & Layout
│   │   └── main.tsx       # Entry Point
│   └── index.html
├── server/                # Backend (Express + tRPC)
│   ├── _core/             # Framework Core (ไม่ควรแก้ไข)
│   ├── db.ts              # Database Helpers
│   ├── routers.ts         # tRPC Procedures
│   └── storage.ts         # S3 Storage Helpers
├── drizzle/               # Database Schema
│   └── schema.ts
├── shared/                # Shared Types & Constants
└── package.json
```

---

## การพัฒนาฟีเจอร์ใหม่

### ขั้นตอนการพัฒนา (4 จุดสัมผัสหลัก)

1. **อัพเดท Schema** ใน `drizzle/schema.ts` แล้วรัน `pnpm db:push`
2. **เพิ่ม Database Helpers** ใน `server/db.ts`
3. **สร้าง tRPC Procedures** ใน `server/routers.ts`
4. **สร้าง UI** ใน `client/src/pages/` และเรียกใช้ผ่าน `trpc.*.useQuery/useMutation`

### ตัวอย่างการเพิ่มฟีเจอร์ Todo

#### 1. เพิ่ม Table ใน `drizzle/schema.ts`

```typescript
export const todos = mysqlTable("todos", {
  id: int("id").autoincrement().primaryKey(),
  userId: int("userId").notNull(),
  title: text("title").notNull(),
  completed: boolean("completed").default(false).notNull(),
  createdAt: timestamp("createdAt").defaultNow().notNull(),
});
```

#### 2. Push Schema

```bash
pnpm db:push
```

#### 3. เพิ่ม Helper ใน `server/db.ts`

```typescript
export async function getUserTodos(userId: number) {
  const db = await getDb();
  return db.select().from(todos).where(eq(todos.userId, userId));
}
```

#### 4. เพิ่ม Procedure ใน `server/routers.ts`

```typescript
import { z } from "zod";

export const appRouter = router({
  // ... existing routers
  
  todo: router({
    list: protectedProcedure.query(({ ctx }) =>
      getUserTodos(ctx.user.id)
    ),
    
    create: protectedProcedure
      .input(z.object({ title: z.string() }))
      .mutation(async ({ ctx, input }) => {
        const db = await getDb();
        await db.insert(todos).values({
          userId: ctx.user.id,
          title: input.title,
        });
        return { success: true };
      }),
  }),
});
```

#### 5. สร้าง UI ใน `client/src/pages/TodoPage.tsx`

```tsx
export default function TodoPage() {
  const { data: todos, isLoading } = trpc.todo.list.useQuery();
  const createMutation = trpc.todo.create.useMutation();

  if (isLoading) return <div>Loading...</div>;

  return (
    <div>
      {todos?.map(todo => (
        <div key={todo.id}>{todo.title}</div>
      ))}
    </div>
  );
}
```

---

## การใช้งาน Authentication

### ตรวจสอบสถานะการล็อกอิน

```tsx
import { useAuth } from "@/_core/hooks/useAuth";

function MyComponent() {
  const { user, isAuthenticated, loading } = useAuth();
  
  if (loading) return <div>Loading...</div>;
  if (!isAuthenticated) return <div>Please login</div>;
  
  return <div>Hello {user.name}</div>;
}
```

### ปุ่ม Login/Logout

```tsx
import { getLoginUrl } from "@/const";

function LoginButton() {
  const { isAuthenticated, logout } = useAuth();
  
  if (isAuthenticated) {
    return <button onClick={logout}>Logout</button>;
  }
  
  return <a href={getLoginUrl()}>Login</a>;
}
```

---

## การใช้งาน LLM Integration

```typescript
import { invokeLLM } from "./server/_core/llm";

// ใน tRPC Procedure
const response = await invokeLLM({
  messages: [
    { role: "system", content: "You are a helpful assistant." },
    { role: "user", content: "สวัสดีครับ" },
  ],
});

console.log(response.choices[0].message.content);
```

---

## การใช้งาน File Storage (S3)

```typescript
import { storagePut } from "./server/storage";

// Upload ไฟล์
const { url } = await storagePut(
  `user-${userId}/avatar.png`,
  fileBuffer,
  "image/png"
);

// เก็บ URL ในฐานข้อมูล
await db.update(users)
  .set({ avatarUrl: url })
  .where(eq(users.id, userId));
```

---

## การใช้งาน Image Generation

```typescript
import { generateImage } from "./server/_core/imageGeneration";

const { url } = await generateImage({
  prompt: "A beautiful sunset over mountains"
});
```

---

## การใช้งาน Voice Transcription

```typescript
import { transcribeAudio } from "./server/_core/voiceTranscription";

const result = await transcribeAudio({
  audioUrl: "https://storage.example.com/audio.mp3",
  language: "th",
});

console.log(result.text); // ข้อความที่ถอดเสียง
```

---

## คำสั่งที่ใช้บ่อย

```bash
# Development
pnpm dev              # เริ่ม dev server
pnpm build            # Build สำหรับ production
pnpm preview          # Preview production build

# Database
pnpm db:push          # Push schema changes
pnpm db:studio        # เปิด Drizzle Studio (GUI)

# Testing
pnpm test             # รัน tests
pnpm test:watch       # รัน tests แบบ watch mode
```

---

## การ Deploy

### ผ่าน Manus Platform

1. Save Checkpoint ใน Management UI
2. คลิกปุ่ม "Publish" ที่มุมขวาบน
3. เว็บไซต์จะถูก deploy อัตโนมัติ

### Deploy เอง

```bash
# Build
pnpm build

# ไฟล์ที่ต้อง deploy
# - dist/ (frontend build)
# - server/ (backend code)
# - package.json
# - ตั้งค่า environment variables บน hosting
```

---

## การแก้ปัญหาที่พบบ่อย

### ฐานข้อมูลเชื่อมต่อไม่ได้

- ตรวจสอบ `DATABASE_URL` ใน `.env`
- ตรวจสอบว่า database server เปิดอยู่
- ตรวจสอบ firewall และ network access

### tRPC Query ไม่ทำงาน

- ตรวจสอบว่า procedure ถูกเพิ่มใน `server/routers.ts`
- ตรวจสอบว่า dev server กำลังทำงาน
- เปิด Network tab ใน DevTools ดู error

### OAuth ไม่ทำงาน

- ตรวจสอบ `VITE_APP_ID` และ `OAUTH_SERVER_URL`
- ตรวจสอบว่า callback URL ถูกตั้งค่าใน Manus Dashboard
- ลบ cookies แล้วลองใหม่

---

## Resources

- [tRPC Documentation](https://trpc.io)
- [Drizzle ORM Documentation](https://orm.drizzle.team)
- [React Documentation](https://react.dev)
- [Tailwind CSS Documentation](https://tailwindcss.com)
- [Manus Platform](https://manus.im)

---

## การติดต่อและรายงานปัญหา

หากพบปัญหาหรือต้องการความช่วยเหลือ กรุณาติดต่อที่:
- Manus Support: https://help.manus.im

---

**หมายเหตุ**: โปรเจคนี้ถูกสร้างด้วย Manus Web App Template และพร้อมใช้งานทันที

